(()=>{"use strict";var t={rotateX:45,rotateY:35};function n(t){return t*(180/Math.PI)}function e(t){return t*(Math.PI/180)}function r(t,n,e){return{x:Math.sin(t/2)*Math.cos(n/2)*Math.cos(e/2)-Math.cos(t/2)*Math.sin(n/2)*Math.sin(e/2),y:Math.cos(t/2)*Math.sin(n/2)*Math.cos(e/2)+Math.sin(t/2)*Math.cos(n/2)*Math.sin(e/2),z:Math.cos(t/2)*Math.cos(n/2)*Math.sin(e/2)-Math.sin(t/2)*Math.sin(n/2)*Math.cos(e/2),w:Math.cos(t/2)*Math.cos(n/2)*Math.cos(e/2)+Math.sin(t/2)*Math.sin(n/2)*Math.sin(e/2)}}var o=function(t){return t<9},a=function(t){return t%9<3},c=function(t){return(t+1)%3==0},i=function(t){return t%3==0},u=function(t){return t%9>5},s=function(t){return t>17},f=function(t){return(t-1)%3==0},l=function(t){return t>8&&t<18},h=function(t){var n=t%9;return n>=3&&n<=5};function d(t){var e={x:Math.atan2(t[9],t[10]),y:Math.atan2(-t[8],Math.sqrt(Math.pow(t[9],2)+Math.pow(t[10],2))),z:Math.atan2(t[4],t[0])};return{x:n(e.x),y:n(e.y),z:n(e.z)}}function v(t,n){var e=n.x,r=n.y,o=n.z,a=n.w,c=e+e,i=r+r,u=o+o,s=e*c,f=e*i,l=e*u,h=r*i,d=r*u,v=o*u,y=a*c,b=a*i,m=a*u;return t[0]=1-(h+v),t[1]=f+m,t[2]=l-b,t[3]=0,t[4]=f-m,t[5]=1-(s+v),t[6]=d+y,t[7]=0,t[8]=l+b,t[9]=d-y,t[10]=1-(s+h),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function y(t,n,e){var r=n[0],o=n[1],a=n[2],c=n[3],i=n[4],u=n[5],s=n[6],f=n[7],l=n[8],h=n[9],d=n[10],v=n[11],y=n[12],b=n[13],m=n[14],g=n[15],p=e[0],M=e[1],S=e[2],E=e[3];return t[0]=p*r+M*i+S*l+E*y,t[1]=p*o+M*u+S*h+E*b,t[2]=p*a+M*s+S*d+E*m,t[3]=p*c+M*f+S*v+E*g,p=e[4],M=e[5],S=e[6],E=e[7],t[4]=p*r+M*i+S*l+E*y,t[5]=p*o+M*u+S*h+E*b,t[6]=p*a+M*s+S*d+E*m,t[7]=p*c+M*f+S*v+E*g,p=e[8],M=e[9],S=e[10],E=e[11],t[8]=p*r+M*i+S*l+E*y,t[9]=p*o+M*u+S*h+E*b,t[10]=p*a+M*s+S*d+E*m,t[11]=p*c+M*f+S*v+E*g,p=e[12],M=e[13],S=e[14],E=e[15],t[12]=p*r+M*i+S*l+E*y,t[13]=p*o+M*u+S*h+E*b,t[14]=p*a+M*s+S*d+E*m,t[15]=p*c+M*f+S*v+E*g,t}function b(){return new Array(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}var m=function(t){return new Float32Array(new DOMMatrixReadOnly(getComputedStyle(t).transform).toFloat32Array())};function g(t,n){return Math.floor(Math.random()*(n-t+1))+t}function p(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}window.solve=function(){var t;t="F' L' U' L U F".split(" "),Tt(t)};var M=document.createElement("canvas");M.width=M.height=1;var S=M.getContext("2d",{willReadFrequently:!0}),E=function(t){S.clearRect(0,0,1,1),S.fillStyle="#000",S.fillStyle=t;var n,e=S.fillStyle;if(S.fillStyle="#fff",S.fillStyle=t,e===S.fillStyle)return S.fillRect(0,0,1,1),function(t){if(Array.isArray(t))return p(t)}(n=S.getImageData(0,0,1,1).data)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,n){if(t){if("string"==typeof t)return p(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?p(t,n):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()};function w(t,n){return t=Math.ceil(t),n=Math.floor(n),Math.floor(Math.random()*(n-t)+t)}var A=function(t,n,e){e/=100;var r=n*Math.min(e,1-e)/100,o=function(n){var o=(n+t/30)%12,a=e-r*Math.max(Math.min(o-3,9-o,1),-1);return Math.round(255*a).toString(16).padStart(2,"0")};return"#".concat(o(0)).concat(o(8)).concat(o(4))},L=Array.from(document.querySelectorAll("dialog")),k=function(t){return L.find((function(n){return n.dataset.id===t}))},q=function(t,n){t.addEventListener("touchstart",x,!1),t.addEventListener("mousedown",x,!1),t.addEventListener("click",n,!1)},x=function(t){return t.stopPropagation(),!1},I=document.querySelector(":root"),_=function(t){return getComputedStyle(I).getPropertyValue(t)},D=function(t,n){I.style.setProperty(t,n)},U=255,X="settings",F=k("settings"),Y=F.querySelector(".close-dialog"),P=F.querySelector(".randomize-btn"),R=F.querySelectorAll(".input-color"),z=Array.from(F.querySelectorAll(".input-alpha")),O=Array.from(F.querySelectorAll(".input-spacing")),T=F.querySelector(".dialog-settings-btn-save"),Z=F.querySelector(".dialog-settings-btn-reset"),j={},N=function(t){B(t.target,t.target.dataset.unit)},B=function(t,n){t.previousElementSibling.value=t.value+n},W=function(t,n,e){D(t,n+e)},C=function(t,n){D(t,n.color+function(t){try{return Math.round(t).toString(16)}catch(t){return console.warn("error converting alpha value"),"FF"}}(Number(n.alpha)))},G=function(t,n,e,r){t[n]={color:e,alpha:Number(r)}},H=function(t,n,e){t[n]=e},J=function(){k("settings").close()},$=function(t){return z.find((function(n){return n.id===t+"-alpha"}))},K=function(t,n){$(t).value=Number(n)},V=function(t){return j[t]},Q=function(){var t=360*Math.random();R.forEach((function(n,e){var r=nt(n.id),o={color:A((t+137.508*e)%360,w(40,100),w(0,100)),alpha:4==w(0,7)?w(156,255):255};C(r,o),n.value=o.color,K(n.id,o.alpha||U)}))},tt=function(t){var n,e,r={};return R.forEach((function(t){var n,e=(n=t.id,$(n).value),o=nt(t.id);G(r,o,t.value,e),C(o,r[o])})),O.forEach((function(t){var n=nt(t.id);H(r,n,t.value),W(n,r[n],t.dataset.unit)})),n=X,e=r,localStorage.setItem(n,JSON.stringify(e)),J(),x(t)},nt=function(t){return"--".concat(t,"0")},et=function(t){return R.forEach((function(t){var n=nt(t.id),e=V(n);C(n,e),t.value=e.color,K(t.id,U)})),O.forEach((function(t){var n=nt(t.id),e=V(n);W(n,e),t.value=""+parseInt(e),B(t,t.dataset.unit)})),x(t)},rt=function(t){var n=document.querySelector(".btn_scramble"),e=document.querySelector(".btn_reset");t?(at(n),ot(e)):(at(e),ot(n))},ot=function(t){t.classList.contains("hide")||t.classList.add("hide")},at=function(t){t.classList.contains("hide")&&t.classList.remove("hide")},ct=function(){k("settings").showModal()},it=function(t){return mt(),x(t)},ut=function(t){return Ut(t),x(t)},st=function(t){return Xt(t.target.dataset.id),x(t)},ft=function(t){return Ot(t),x(t)};function lt(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}var ht=[],dt=[],vt=0,yt=!1,bt=!1,mt=function(){St()||bt||pt()},gt=function(){return document.querySelector(".rubiks_cube")},pt=function(){document.querySelectorAll(".cube_container").forEach((function(t,n){At(t.dataset.posInit,t),kt(0,0,0,t,n)})),vt=0,rt(!0)},Mt=function(t){return ht[t].cube},St=function(){return vt<0&&(vt=0),0!=vt},Et=function(){0==(vt-=1)&&(yt=!1),0==dt.length&&0==vt&&0==yt&&rt(function(){for(var t=!0,n=ht[0].cube,o=d(m(n)),a=r(e(o.x),e(o.y),e(o.z)),c=v(b(),a),i=0;i<ht.length;i++){var u=ht[i],s=m(u.cube),f=d(y(b(),s,c));if(0!=Math.round(f.x)||0!=Math.round(f.y)||0!=Math.round(f.z)){t=!1;break}}return t}()),wt()},wt=function(){dt.length>0&&!St()&&!bt&&Xt(dt[0])},At=function(t,n){n.dataset.pos=t,ht[t]={cube:n,pos:t}},Lt=function(n,e,r){n=Math.abs(n)>90?90*Math.sign(n):n,t.rotateX=n,t.rotateY=e,r.style.transform="rotateX("+n+"deg) rotateY("+e+"deg) translateZ(0)"},kt=function(t,n,o,a,c){vt+=1;var i,u,s,f,l,h,d,v,y,b,g,p,M,S,E,w,A,L,k,q,x,I,_,D,U,X,F,Y=m(a);i=Y,s=(u=r(e(t),e(n),e(o))).x,k=1-((M=(f=u.y)*(v=f+f))+(E=(l=u.z)*(y=l+l))),q=(g=s*v)-(L=(h=u.w)*y),x=(p=s*y)+(A=h*v),I=g+L,_=1-((b=s*(d=s+s))+E),D=(S=f*y)-(w=h*d),U=p-A,X=S+w,F=1-(b+M),i[0]=k,i[1]=q,i[2]=x,i[3]=0,i[4]=I,i[5]=_,i[6]=D,i[7]=0,i[8]=U,i[9]=X,i[10]=F,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,xt(a,Y)},qt=function(t,n,o,a){(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&(vt+=1);var c=m(a),i=r(e(t),e(n),e(o)),u=v(b(),i),s=b();return s=y(s,u,c),xt(a,s),s},xt=function(t,n){var e=n[0],r=n[1],o=n[2],a=n[3],c=n[4],i=n[5],u=n[6],s=n[7],f=n[8],l=n[9],h=n[10],d=n[11],v=n[12],y=n[13],b=n[14],m=n[15];t.style.transform="matrix3d(".concat(e,", ").concat(r,", ").concat(o,", ").concat(a,", ").concat(c,", ").concat(i,", ").concat(u,", ").concat(s,", ").concat(f,", ").concat(l,", ").concat(h,", ").concat(d,", ").concat(v,", ").concat(y,", ").concat(b,", ").concat(m,")")},It=[2,5,8,1,-1,7,0,3,6],_t=[6,3,0,7,-1,1,8,5,2],Dt=function(t,n){for(var e=function(t){return 1==t?_t:It}(n),r=[],o=0;o<t.length;o++)if(4!=o){var a=t[o],c=e[o];r.unshift({index:o,pos:t[c].pos})}for(var i=0,u=r;i<u.length;i++){var s=u[i];a=t[s.index],At(s.pos,a.cube)}},Ut=function(){var t=document.querySelector(".rubiks_cube");Lt(-35,-45,t)},Xt=function(t){if(!bt)if(St())dt.push(t);else{var n=1;if(t.length>0)if("'"===t[1])n=-1;else if("2"===t[1]){var e=dt.shift();dt.unshift(t[0]),dt.unshift(e)}var r=t[0];"X"===r||"Y"===r||"Z"===r?Yt(t,n):Ft(t,n),dt.shift()}},Ft=function(t,n){var e=zt(t,n),r=e.newPosDico,o=e.signToUpdatePos;Dt(r,o),yt=!0},Yt=function(t,n){Rt(t,n).forEach((function(t){var n=t.newPosDico,e=t.signToUpdatePos;Dt(n,e)}))},Pt=function(t,n,e,r){var o=[],a=function(t){var n=[];return ht.forEach((function(e,r){t(r)&&n.push({pos:r,cube:e.cube})})),n}(t);return a.forEach((function(t){qt(n,e,r,t.cube),o.push(t)})),o},Rt=function(t,n){var e=[];switch(t[0]){case"X":e.push(zt("R",n)),e.push(zt("M'",-n)),e.push(zt("L'",-n));break;case"Y":e.push(zt("U",n)),e.push(zt("E",n)),e.push(zt("D'",-n));break;case"Z":e.push(zt("F",n)),e.push(zt("S",n)),e.push(zt("B'",-n))}return e},zt=function(t,n){var e=[];switch(t[0]){case"U":e=Pt(o,0,-90*n,0);break;case"D":e=Pt(s,0,90*n,0),n*=-1;break;case"F":e=Pt(a,0,0,90*n),n*=-1;break;case"B":e=Pt(u,0,0,-90*n);break;case"R":e=Pt(c,90*n,0,0),n*=-1;break;case"L":e=Pt(i,-90*n,0,0);break;case"M":e=Pt(f,-90*n,0,0);break;case"E":e=Pt(l,0,-90*n,0);break;case"S":e=Pt(h,0,0,90*n),n*=-1}return{newPosDico:e,signToUpdatePos:n}},Ot=function(){if(!bt){var t=function(t){for(var n=["U","D","L","R","F","B","M","E","S"],e=["","'","2"],r=[],o=0;o<21;o++){var a=n[g(0,n.length-1)],c=e[g(0,e.length-1)];r.push(a+c)}return console.log(r),r}();Tt(t)}},Tt=function(t){var n,e=function(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(t){if("string"==typeof t)return lt(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?lt(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,i=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return c=t.done,t},e:function(t){i=!0,a=t},f:function(){try{c||null==e.return||e.return()}finally{if(i)throw a}}}}(t);try{for(e.s();!(n=e.n()).done;){var r=n.value;dt.push(r)}}catch(t){e.e(t)}finally{e.f()}wt()},Zt=[];Zt.ArrowUp="UP",Zt.ArrowLeft="LEFT",Zt.ArrowDown="DOWN",Zt.ArrowRight="RIGHT",Zt.r="R",Zt.d="D",Zt.u="U",Zt.l="L",Zt.b="B",Zt.f="F",Zt.R="R",Zt.D="D",Zt.U="U",Zt.L="L",Zt.B="B",Zt.F="F",Zt.m="M",Zt.e="E",Zt.s="S",Zt.M="M",Zt.E="E",Zt.S="S",Zt.x="X",Zt.X="X",Zt.y="Y",Zt.Y="Y",Zt.z="Z",Zt.Z="Z";var jt,Nt;"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("/rubiks_cube/service-worker.js").then((function(t){console.log("SW registered: ",t)})).catch((function(t){console.log("SW registration failed: ",t)}))})),q(Y,J),q(P,Q),q(Z,et),q(T,tt),O.forEach((function(t){var n;n=N,t.addEventListener("input",n,!1)})),R.forEach((function(t){var n,e,r=nt(t.id);!function(t,n,e){G(j,t,n,255)}(r,(n=_(r),e=E(n),"#"+((256|e[0]).toString(16).slice(1)+(256|e[1]).toString(16).slice(1)+(256|e[2]).toString(16).slice(1))))})),O.forEach((function(t){var n=nt(t.id),e=_(n);!function(t,n){H(j,t,n)}(n,parseInt(e))})),(Nt=function(t){try{if(!localStorage.getItem(t))return;return JSON.parse(localStorage.getItem(t))}catch(t){console.error("failed to parse localStorage")}}(X))&&(R.forEach((function(t){var n=nt(t.id),e=Nt[n];e&&(C(n,e),t.value=e.color,K(t.id,e.alpha||U))})),O.forEach((function(t){var n=nt(t.id),e=Nt[n];e&&(W(n,e,t.dataset.unit),t.value=e,B(t,t.dataset.unit))}))),function(){var n,e,r,o,a,c=document.querySelector(".scene_container"),i=document.querySelector(".rubiks_cube"),u=document.querySelectorAll(".cube_container_position"),s=void 0,f=-1,l=!1,h=[],v=0,y=0,b=[],g=!1;function p(n){if(0==l&&(n.target===c||c.contains(n.target))){if(l=!0,!St())for(var e=0;e<u.length;e++)if(n.target===Mt(e)||u[e].contains(n.target)){s=Mt(e),f=s.dataset.pos;break}return s&&-1!=f&&St(),!1,gt().classList.add("drag-cube"),v=t.rotateY,y=-t.rotateX,"touchstart"===n.type?(r=n.touches[0].clientX-v,o=n.touches[0].clientY-y):(r=n.clientX-v,o=n.clientY-y),!1}n.preventDefault()}function M(t){if(l)return g=!1,gt().classList.remove("drag-line"),bt&&(bt=!1),gt().classList.remove("drag-cube"),bt&&(bt=!1),function(){if(a){var t=h.find((function(t){return a==t.axis})).line;b=t.forEach((function(t,n){var e=Mt(t),r=d(b[n]);kt(r.x,r.y,r.z,e,t)}))}}(),a=void 0,r=n,o=e,b=[],l=!1,s=void 0,f=-1,h=[],t.preventDefault(),!1}function S(t){if(l){if(t.preventDefault(),"touchmove"===t.type?(n=t.touches[0].clientX-r,e=t.touches[0].clientY-o):(n=t.clientX-r,e=t.clientY-o),v=n,y=e,!g)return Lt(-e,n,i),!1;if(console.log(n,e),a?h.find((function(t){return t.axis==a})).line:(Math.abs(n)>6||Math.abs(e)>6)&&(Math.abs(n)-Math.abs(e)<7?a="Z":Math.abs(n)>Math.abs(e)?a="X":Math.abs(n)<Math.abs(e)&&(a="Y"),a&&(S=h.find((function(t){return a==t.axis})).line,b=S.map((function(t){var n=Mt(t);return m(n)})))),!a)return!1;console.log("AXIS:",a);var c=h.find((function(t){return a==t.axis})).line,u=-e,s=n,f=[0,0,0],d=0;"X"==a?(f[1]=1,d=Math.min(Math.max(-2.2,s),2.2)):"Y"==a?(f[0]=1,d=Math.min(Math.max(-2.2,s),2.2)):"Z"==a&&(f[0]=1,d=Math.min(Math.max(-2.2,u),2.2));for(var p=0;p<c.length;p++){var M=c[p];qt(d*f[0],d*f[1],d*f[2],Mt(M),!1)}return!1}var S}c.addEventListener("touchstart",p,!1),c.addEventListener("touchend",M,!1),c.addEventListener("touchmove",S,!1),c.addEventListener("mousedown",p,!1),c.addEventListener("mouseup",M,!1),c.addEventListener("mousemove",S,!1)}(),window.addEventListener("keydown",(function(t){var n=t.key;if(Zt[n])switch(Zt[n]){case"UP":var e=document.querySelector(".rubiks_cube");qt(25,0,0,e);break;case"DOWN":e=document.querySelector(".rubiks_cube"),qt(-25,0,0,e);break;case"RIGHT":e=document.querySelector(".rubiks_cube"),qt(0,25,0,e);break;case"LEFT":e=document.querySelector(".rubiks_cube"),qt(0,-25,0,e);break;default:Xt(Zt[n]+(function(t){return t.shiftKey}(t)?"'":""))}})),document.querySelectorAll(".btn_move").forEach((function(t){q(t,st)})),jt=document.querySelector(".btn_scramble"),q(jt,ft),function(){var t=document.querySelector(".btn_center");q(t,ut)}(),function(){var t=document.querySelector(".btn_reset");q(t,it)}(),function(){var t=document.querySelector(".helper-icon-settings");q(t,ct)}(),document.querySelectorAll(".cube_container").forEach((function(t,n){At(t.dataset.posInit,t),kt(0,0,0,t,n),t.addEventListener("transitionend",Et)})),Ut()})();